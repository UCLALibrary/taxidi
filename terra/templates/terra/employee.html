{% extends "terra/base.html" %}

{% load terra_extras %}

{% block title %}{{employee}}{% endblock %}

{% block supplemental_css %}
<style>
    body {
        padding-top: 6.5rem;
}
</style>
{% endblock %}

{% block body %}
    <h1>{{employee}}</h1>
    <h3>{{employee.get_type_display}}, {{employee.unit}}</h3>
    <br>
    <h2>FY {{fy}} Travel Requests</h2>
    <br>
    <table class="table">
        <thead class="thead-light">
            <tr>
                <th scope="col">Activity</th>
                <th scope="col">Dates</th>
                <th scope="col">Closed</th>
                <th scope="col">Amount Requested in FY{{fy}}</th>
                <th scope="col">Amount Spent in FY{{fy}}</th>
                <th scope="col">Days Out Working</th>   
            </tr>
        </thead>
        <tbody>
            <tr>
                <th id="par" colspan="6" scope="colgroup">Professional Development</th>
            </tr>
            {% for treq in employee.travelrequest_set.all %}
            
                {% for i in actualexpenses_fy %}
                {% if i.id == treq.id %}
                    {% if treq.administrative == False %}
                    {% if i.actualexpenses_fy != 0 or treq.departure_date >= fy_start and treq.return_date <= fy_end %}

                        <tr>
                            <td><a href="/treq/{{treq.pk}}">{{treq.activity.name}} </a></td>
                            <td>{{treq.departure_date}} - {{treq.return_date}}</td>
                            <td>{{treq.closed|check_or_cross|safe}}</td>
                            <td>{{i.funding_fy|currency}}</td>
                            <td>{{i.actualexpenses_fy|currency}}</td>
                            <td>{{treq.days_ooo}}</td>
                        </tr>
                    {% endif %}
                    {% endif %}

                    {% endif %}
               {% endfor %}
            
            {% endfor %}
            <tr><th colspan="6" scope="colgroup"><br></th></tr>
            <tr>
                <th id="par" colspan="6" scope="colgroup">Administrative</th>
            </tr>
            {% for treq in employee.travelrequest_set.all %}
            {% for i in actualexpenses_fy %}
                {% if i.id == treq.id %}
                
                    {% if treq.administrative == True %}
                        <tr>
                            <td><a href="/treq/{{treq.pk}}">{{treq.activity.name}} </a></td>
                            <td>{{treq.departure_date}} - {{treq.return_date}}</td>
                            <td>{{treq.closed|check_or_cross|safe}}</td>
                            <td>{{i.funding_fy|currency}}</td>
                            <td>{{i.actualexpenses_fy|currency}}</td>
                            <td>{{treq.days_ooo}}</td>
                        </tr>
                    {% endif %}
                {% endif %}
                {% endfor %}
            {% endfor %}
        </tbody>
        
        {% for employee_id, totals in report.items %}
            {% if employee_id == employee.id %}

                <tfoot>
                    <tr><th colspan="6" scope="colgroup"><br></th></tr>
                    <tr>
                        <th>Totals</th>
                        <th></th>
                        <th></th>
                        <th>{{totals.total_requested|currency}}</th>
                        <th>{{totals.total_spent|currency}}</th>
                        <th>{{totals.days_away}}</th>
                    </tr>
                </tfoot>
            {% endif %}
        {% endfor %}
    </table>

{% endblock %}